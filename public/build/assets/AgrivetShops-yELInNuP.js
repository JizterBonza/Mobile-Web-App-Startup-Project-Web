import{r as t,u as D,j as s,a as f,L as E}from"./app-BOLgj3qB.js";import{A as B}from"./AdminLayout-CG6SnJGX.js";import{P as L}from"./PinLocationMap-DQbPXVYU.js";function G({auth:n,agrivet:r,shops:v=[],flash:o}){const[_,y]=t.useState(!1),[S,h]=t.useState(!1),[N,C]=t.useState(!1),[w,m]=t.useState(!1),[b,k]=t.useState(!1),[A,p]=t.useState(!1),[x,$]=t.useState(null),[u,g]=t.useState(null),a=D({shop_name:"",shop_description:"",shop_address:"",shop_city:"",shop_postal_code:"",shop_lat:"",shop_long:"",contact_number:"",shop_status:"active"}),l=D({shop_name:"",shop_description:"",shop_address:"",shop_city:"",shop_postal_code:"",shop_lat:"",shop_long:"",contact_number:"",shop_status:"active"});t.useEffect(()=>{_?setTimeout(()=>h(!0),10):h(!1)},[_]),t.useEffect(()=>{N?setTimeout(()=>m(!0),10):m(!1)},[N]),t.useEffect(()=>{b?setTimeout(()=>p(!0),10):p(!1)},[b]);const j=()=>{h(!1),setTimeout(()=>{y(!1),a.reset()},300)},d=()=>{m(!1),setTimeout(()=>{C(!1),$(null),l.reset()},300)},i=()=>{p(!1),setTimeout(()=>{k(!1),g(null)},300)};t.useEffect(()=>{o!=null&&o.success&&(j(),d(),i(),a.reset(),l.reset(),g(null))},[o]);const c=()=>{var e;return((e=n==null?void 0:n.user)==null?void 0:e.user_type)==="admin"?"/dashboard/admin/agrivets":"/dashboard/super-admin/agrivets"},M=e=>{e.preventDefault(),a.post(`${c()}/${r.id}/shops`,{preserveScroll:!0,onSuccess:()=>{a.reset()}})},R=e=>{$(e),l.setData({shop_name:e.shop_name,shop_description:e.shop_description||"",shop_address:e.shop_address||"",shop_city:e.shop_city||"",shop_postal_code:e.shop_postal_code||"",shop_lat:e.shop_lat||"",shop_long:e.shop_long||"",contact_number:e.contact_number||"",shop_status:e.shop_status||"active"}),C(!0),m(!1)},F=e=>{e.preventDefault(),l.put(`${c()}/${r.id}/shops/${x.id}`,{preserveScroll:!0,onSuccess:()=>{d()}})},I=e=>{const q=v.find(z=>z.id===e);g(q),k(!0),p(!1)},T=()=>{u&&f.delete(`${c()}/${r.id}/shops/${u.id}`,{preserveScroll:!0,onSuccess:()=>{i()}})},P=e=>e==="active"?s.jsx("span",{className:"badge badge-success",children:"Active"}):s.jsx("span",{className:"badge badge-danger",children:"Inactive"});return s.jsxs(B,{auth:n,title:`Shops - ${r.name}`,children:[(o==null?void 0:o.success)&&s.jsxs("div",{className:"alert alert-success alert-dismissible fade show",role:"alert",children:[s.jsx("strong",{children:"Success!"})," ",o.success,s.jsx("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:()=>f.reload({only:["flash"]}),children:s.jsx("span",{"aria-hidden":"true",children:"×"})})]}),(o==null?void 0:o.error)&&s.jsxs("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:[s.jsx("strong",{children:"Error!"})," ",o.error,s.jsx("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:()=>f.reload({only:["flash"]}),children:s.jsx("span",{"aria-hidden":"true",children:"×"})})]}),s.jsx("div",{className:"row mb-3",children:s.jsx("div",{className:"col-12",children:s.jsxs(E,{href:c(),className:"btn btn-secondary btn-sm",children:[s.jsx("i",{className:"fas fa-arrow-left"})," Back to Agrivets"]})})}),s.jsx("div",{className:"row",children:s.jsx("div",{className:"col-12",children:s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"card-header",children:[s.jsxs("h3",{className:"card-title",children:["Shops for ",r.name]}),s.jsx("div",{className:"card-tools",children:s.jsxs("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>{y(!0),h(!1)},children:[s.jsx("i",{className:"fas fa-plus"})," Add Shop"]})})]}),s.jsx("div",{className:"card-body table-responsive p-0",children:s.jsxs("table",{className:"table table-hover text-nowrap",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"ID"}),s.jsx("th",{children:"Shop Name"}),s.jsx("th",{children:"Address"}),s.jsx("th",{children:"Contact"}),s.jsx("th",{children:"Vendors"}),s.jsx("th",{children:"Rating"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Created At"}),s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{children:v.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:"9",className:"text-center",children:"No shops found"})}):v.map(e=>s.jsxs("tr",{children:[s.jsx("td",{children:e.id}),s.jsx("td",{children:e.shop_name}),s.jsx("td",{children:e.shop_address||"-"}),s.jsx("td",{children:e.contact_number||"-"}),s.jsx("td",{children:s.jsxs("span",{className:"badge badge-info",children:[e.vendors_count||0," vendor(s)"]})}),s.jsx("td",{children:s.jsxs("span",{className:"badge badge-warning",children:[s.jsx("i",{className:"fas fa-star mr-1"}),e.average_rating||"0.00"," (",e.total_reviews||0,")"]})}),s.jsx("td",{children:P(e.shop_status)}),s.jsx("td",{children:new Date(e.created_at).toLocaleDateString()}),s.jsxs("td",{children:[s.jsx(E,{href:`${c()}/${r.id}/shops/${e.id}/vendors`,className:"btn btn-sm btn-primary mr-1",title:"View Vendors",children:s.jsx("i",{className:"fas fa-users"})}),s.jsx("button",{className:"btn btn-sm btn-info mr-1",onClick:()=>R(e),title:"Edit Shop",children:s.jsx("i",{className:"fas fa-edit"})}),e.shop_status==="active"&&s.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>I(e.id),title:"Deactivate Shop",children:s.jsx("i",{className:"fas fa-trash"})})]})]},e.id))})]})})]})})}),_&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`modal-backdrop fade ${S?"show":""}`,onClick:j}),s.jsx("div",{className:`modal fade ${S?"show":""} d-block`,tabIndex:"-1",style:{zIndex:1050},children:s.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",children:s.jsxs("div",{className:"modal-content",children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h4",{className:"modal-title",children:"Add New Shop"}),s.jsx("button",{type:"button",className:"close",onClick:j,children:s.jsx("span",{children:"×"})})]}),s.jsxs("form",{onSubmit:M,children:[s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{children:["Shop Name ",s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsx("input",{type:"text",className:`form-control ${a.errors.shop_name?"is-invalid":""}`,value:a.data.shop_name,onChange:e=>a.setData("shop_name",e.target.value),required:!0}),a.errors.shop_name&&s.jsx("div",{className:"invalid-feedback",children:a.errors.shop_name})]})}),s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{children:["Status ",s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsxs("select",{className:`form-control ${a.errors.shop_status?"is-invalid":""}`,value:a.data.shop_status,onChange:e=>a.setData("shop_status",e.target.value),required:!0,children:[s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"inactive",children:"Inactive"})]}),a.errors.shop_status&&s.jsx("div",{className:"invalid-feedback",children:a.errors.shop_status})]})})]}),s.jsx("div",{className:"row",children:s.jsx("div",{className:"col-md-12",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Description"}),s.jsx("textarea",{className:`form-control ${a.errors.shop_description?"is-invalid":""}`,value:a.data.shop_description,onChange:e=>a.setData("shop_description",e.target.value),rows:"2"}),a.errors.shop_description&&s.jsx("div",{className:"invalid-feedback",children:a.errors.shop_description})]})})}),s.jsx("div",{className:"row",children:s.jsx("div",{className:"col-md-12",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Pin Location"}),s.jsx(L,{initialLat:a.data.shop_lat?parseFloat(a.data.shop_lat):void 0,initialLng:a.data.shop_long?parseFloat(a.data.shop_long):void 0,initialAddress:a.data.shop_address,initialCity:a.data.shop_city,initialPostalCode:a.data.shop_postal_code,onLocationSelect:e=>{a.setData({shop_lat:e.latitude,shop_long:e.longitude})},height:320,error:a.errors.shop_address})]})})}),s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Address"}),s.jsx("input",{type:"text",className:`form-control ${a.errors.shop_address?"is-invalid":""}`,value:a.data.shop_address,onChange:e=>a.setData("shop_address",e.target.value),placeholder:"Enter address"}),a.errors.shop_address&&s.jsx("div",{className:"invalid-feedback",children:a.errors.shop_address})]})}),s.jsx("div",{className:"col-md-3",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"City"}),s.jsx("input",{type:"text",className:`form-control ${a.errors.shop_city?"is-invalid":""}`,value:a.data.shop_city,onChange:e=>a.setData("shop_city",e.target.value),placeholder:"Enter city"}),a.errors.shop_city&&s.jsx("div",{className:"invalid-feedback",children:a.errors.shop_city})]})}),s.jsx("div",{className:"col-md-3",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Postal Code"}),s.jsx("input",{type:"text",className:`form-control ${a.errors.shop_postal_code?"is-invalid":""}`,value:a.data.shop_postal_code,onChange:e=>a.setData("shop_postal_code",e.target.value),placeholder:"Enter postal code"}),a.errors.shop_postal_code&&s.jsx("div",{className:"invalid-feedback",children:a.errors.shop_postal_code})]})})]}),s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Latitude"}),s.jsx("input",{type:"text",className:`form-control ${a.errors.shop_lat?"is-invalid":""}`,value:a.data.shop_lat,onChange:e=>a.setData("shop_lat",e.target.value),placeholder:"Auto-filled"}),a.errors.shop_lat&&s.jsx("div",{className:"invalid-feedback",children:a.errors.shop_lat})]})}),s.jsx("div",{className:"col-md-3",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Longitude"}),s.jsx("input",{type:"text",className:`form-control ${a.errors.shop_long?"is-invalid":""}`,value:a.data.shop_long,onChange:e=>a.setData("shop_long",e.target.value),placeholder:"Auto-filled"}),a.errors.shop_long&&s.jsx("div",{className:"invalid-feedback",children:a.errors.shop_long})]})})]}),s.jsx("div",{className:"row",children:s.jsx("div",{className:"col-md-12",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Contact Number"}),s.jsx("input",{type:"text",className:`form-control ${a.errors.contact_number?"is-invalid":""}`,value:a.data.contact_number,onChange:e=>a.setData("contact_number",e.target.value)}),a.errors.contact_number&&s.jsx("div",{className:"invalid-feedback",children:a.errors.contact_number})]})})})]}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:j,children:"Cancel"}),s.jsx("button",{type:"submit",className:"btn btn-primary",disabled:a.processing,children:a.processing?"Creating...":"Create Shop"})]})]})]})})})]}),N&&x&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`modal-backdrop fade ${w?"show":""}`,onClick:d}),s.jsx("div",{className:`modal fade ${w?"show":""} d-block`,tabIndex:"-1",style:{zIndex:1050},children:s.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",children:s.jsxs("div",{className:"modal-content",children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h4",{className:"modal-title",children:"Edit Shop"}),s.jsx("button",{type:"button",className:"close",onClick:d,children:s.jsx("span",{children:"×"})})]}),s.jsxs("form",{onSubmit:F,children:[s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{children:["Shop Name ",s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsx("input",{type:"text",className:`form-control ${l.errors.shop_name?"is-invalid":""}`,value:l.data.shop_name,onChange:e=>l.setData("shop_name",e.target.value),required:!0}),l.errors.shop_name&&s.jsx("div",{className:"invalid-feedback",children:l.errors.shop_name})]})}),s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{children:["Status ",s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsxs("select",{className:`form-control ${l.errors.shop_status?"is-invalid":""}`,value:l.data.shop_status,onChange:e=>l.setData("shop_status",e.target.value),required:!0,children:[s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"inactive",children:"Inactive"})]}),l.errors.shop_status&&s.jsx("div",{className:"invalid-feedback",children:l.errors.shop_status})]})})]}),s.jsx("div",{className:"row",children:s.jsx("div",{className:"col-md-12",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Description"}),s.jsx("textarea",{className:`form-control ${l.errors.shop_description?"is-invalid":""}`,value:l.data.shop_description,onChange:e=>l.setData("shop_description",e.target.value),rows:"2"}),l.errors.shop_description&&s.jsx("div",{className:"invalid-feedback",children:l.errors.shop_description})]})})}),s.jsx("div",{className:"row",children:s.jsx("div",{className:"col-md-12",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Pin Location"}),s.jsx(L,{initialLat:l.data.shop_lat?parseFloat(l.data.shop_lat):void 0,initialLng:l.data.shop_long?parseFloat(l.data.shop_long):void 0,initialAddress:l.data.shop_address,initialCity:l.data.shop_city,initialPostalCode:l.data.shop_postal_code,onLocationSelect:e=>{l.setData({shop_address:e.address,shop_city:e.city??"",shop_postal_code:e.postal_code??"",shop_lat:e.latitude,shop_long:e.longitude})},height:320,error:l.errors.shop_address})]})})}),s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Address"}),s.jsx("input",{type:"text",className:`form-control ${l.errors.shop_address?"is-invalid":""}`,value:l.data.shop_address,onChange:e=>l.setData("shop_address",e.target.value),placeholder:"Filled by pinned location",readOnly:!0}),l.errors.shop_address&&s.jsx("div",{className:"invalid-feedback",children:l.errors.shop_address})]})}),s.jsx("div",{className:"col-md-3",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"City"}),s.jsx("input",{type:"text",className:`form-control ${l.errors.shop_city?"is-invalid":""}`,value:l.data.shop_city,onChange:e=>l.setData("shop_city",e.target.value),placeholder:"Auto-filled or enter city"}),l.errors.shop_city&&s.jsx("div",{className:"invalid-feedback",children:l.errors.shop_city})]})}),s.jsx("div",{className:"col-md-3",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Postal Code"}),s.jsx("input",{type:"text",className:`form-control ${l.errors.shop_postal_code?"is-invalid":""}`,value:l.data.shop_postal_code,onChange:e=>l.setData("shop_postal_code",e.target.value),placeholder:"Auto-filled or enter postal code"}),l.errors.shop_postal_code&&s.jsx("div",{className:"invalid-feedback",children:l.errors.shop_postal_code})]})})]}),s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Latitude"}),s.jsx("input",{type:"text",className:`form-control ${l.errors.shop_lat?"is-invalid":""}`,value:l.data.shop_lat,onChange:e=>l.setData("shop_lat",e.target.value),placeholder:"Auto-filled"}),l.errors.shop_lat&&s.jsx("div",{className:"invalid-feedback",children:l.errors.shop_lat})]})}),s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Longitude"}),s.jsx("input",{type:"text",className:`form-control ${l.errors.shop_long?"is-invalid":""}`,value:l.data.shop_long,onChange:e=>l.setData("shop_long",e.target.value),placeholder:"Auto-filled"}),l.errors.shop_long&&s.jsx("div",{className:"invalid-feedback",children:l.errors.shop_long})]})})]}),s.jsx("div",{className:"row",children:s.jsx("div",{className:"col-md-12",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Contact Number"}),s.jsx("input",{type:"text",className:`form-control ${l.errors.contact_number?"is-invalid":""}`,value:l.data.contact_number,onChange:e=>l.setData("contact_number",e.target.value)}),l.errors.contact_number&&s.jsx("div",{className:"invalid-feedback",children:l.errors.contact_number})]})})}),s.jsx("hr",{className:"my-4"}),s.jsxs("h5",{className:"text-info mb-3",children:[s.jsx("i",{className:"fas fa-chart-bar mr-2"}),"Shop Statistics (Read-only)"]}),s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Average Rating"}),s.jsx("input",{type:"text",className:"form-control",value:x.average_rating||"0.00",readOnly:!0,disabled:!0})]})}),s.jsx("div",{className:"col-md-6",children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Total Reviews"}),s.jsx("input",{type:"text",className:"form-control",value:x.total_reviews||"0",readOnly:!0,disabled:!0})]})})]})]}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:d,children:"Cancel"}),s.jsx("button",{type:"submit",className:"btn btn-primary",disabled:l.processing,children:l.processing?"Updating...":"Update Shop"})]})]})]})})})]}),b&&u&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`modal-backdrop fade ${A?"show":""}`,onClick:i}),s.jsx("div",{className:`modal fade ${A?"show":""} d-block`,tabIndex:"-1",style:{zIndex:1050},children:s.jsx("div",{className:"modal-dialog modal-dialog-centered modal-dialog-scrollable",children:s.jsxs("div",{className:"modal-content",children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h4",{className:"modal-title",children:"Confirm Deactivation"}),s.jsx("button",{type:"button",className:"close",onClick:i,children:s.jsx("span",{children:"×"})})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("p",{children:["Are you sure you want to deactivate ",s.jsx("strong",{children:u.shop_name}),"?"]}),s.jsx("p",{className:"text-muted mb-0",children:'This will set the shop status to "Inactive". The shop will not be visible to users.'})]}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:i,children:"Cancel"}),s.jsx("button",{type:"button",className:"btn btn-danger",onClick:T,children:"Deactivate Shop"})]})]})})})]})]})}export{G as default};
