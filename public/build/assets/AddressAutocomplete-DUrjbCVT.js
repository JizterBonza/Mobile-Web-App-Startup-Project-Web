import{r as n,j as a}from"./app-Dqqv0FCA.js";function ee({value:y="",onChange:m,onPlaceSelect:w,placeholder:M="Enter address",className:_="",error:b,disabled:z=!1,id:F,apiKey:T,countryRestriction:v="PH",inputComponent:E="input",rows:O=2}){const[K,A]=n.useState(y),[d,g]=n.useState([]),[P,u]=n.useState(!1),[V,L]=n.useState(!1),[f,x]=n.useState(-1),[q,C]=n.useState(!1),j=n.useRef(null),k=n.useRef(null),N=n.useRef(null),c=n.useRef(null),h=n.useRef(null),R=()=>T||window.GOOGLE_MAPS_API_KEY||"";n.useEffect(()=>{var p,G;const t=R();if(!t){console.warn("AddressAutocomplete: No Google Maps API key provided. Autocomplete will be disabled.");return}let e=!1,o;const s=()=>{var S,$;if(!e)return($=(S=window.google)==null?void 0:S.maps)!=null&&$.importLibrary?(window.google.maps.importLibrary("places").then(I=>{e||(h.current=I,C(!0))}).catch(I=>{e||console.error("Failed to load Places library",I)}),!0):!1};if((G=(p=window.google)==null?void 0:p.maps)!=null&&G.importLibrary)return s(),()=>{c.current&&clearTimeout(c.current)};if(document.querySelector('script[src*="maps.googleapis.com"]'))return o=setInterval(()=>{s()&&clearInterval(o)},100),()=>{e=!0,o&&clearInterval(o),c.current&&clearTimeout(c.current)};const l=`__agrifyMapsReady_${Date.now()}`;window[l]=function(){window[l]=null,!e&&s()};const i=document.createElement("script");return i.src=`https://maps.googleapis.com/maps/api/js?key=${t}&loading=async&callback=${l}`,i.async=!0,i.defer=!0,i.onerror=()=>{window[l]=null,e||console.error("Failed to load Google Maps script")},document.head.appendChild(i),()=>{e=!0,window[l]=null,c.current&&clearTimeout(c.current)}},[T]),n.useEffect(()=>{const t=h.current;t!=null&&t.AutocompleteSessionToken&&(N.current=new t.AutocompleteSessionToken)},[q]),n.useEffect(()=>{A(y)},[y]);const H=n.useCallback(async t=>{const e=h.current;if(!t||t.length<3||!(e!=null&&e.AutocompleteSuggestion)){g([]),u(!1);return}L(!0);const o={input:t,sessionToken:N.current,...v?{includedRegionCodes:[v]}:{}};try{const{suggestions:s}=await e.AutocompleteSuggestion.fetchAutocompleteSuggestions(o);g(s||[]),u(!!(s&&s.length>0)),x(-1)}catch(s){const r=(s==null?void 0:s.message)??String(s);/Places API \(New\) has not been used|Places API \(New\).*disabled|places\.googleapis\.com/.test(r)?console.warn("AddressAutocomplete: Places API (New) is not enabled for your Google Cloud project. Enable it at https://console.developers.google.com/apis/api/places.googleapis.com/overview then retry. If you just enabled it, wait a few minutes.",s):console.warn("AutocompleteSuggestion fetch failed",s),g([]),u(!1)}finally{L(!1)}},[v]),Y=t=>{const e=t.target.value;A(e),m==null||m(e),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{H(e)},300)},U=t=>{var r,l,i;const e=t==null?void 0:t.placePrediction;if(!e)return"";if((r=e.text)!=null&&r.text)return e.text.text;const o=((l=e.mainText)==null?void 0:l.text)??"",s=((i=e.secondaryText)==null?void 0:i.text)??"";return s?`${o}, ${s}`:o},W=t=>{var o,s,r;const e=t==null?void 0:t.placePrediction;return((o=e==null?void 0:e.mainText)==null?void 0:o.text)??((r=(s=e==null?void 0:e.text)==null?void 0:s.text)==null?void 0:r.split(",")[0])??""},B=t=>{var o,s;const e=t==null?void 0:t.placePrediction;return((o=e==null?void 0:e.secondaryText)==null?void 0:o.text)??((s=e==null?void 0:e.text)==null?void 0:s.text)??""},D=async t=>{const e=t==null?void 0:t.placePrediction;if(!e)return;const o=U(t);A(o),m==null||m(o),g([]),u(!1);try{const s=e.toPlace();await s.fetchFields({fields:["displayName","formattedAddress","location"]});const r=s.location,l=typeof(r==null?void 0:r.lat)=="function"?r.lat():r==null?void 0:r.lat,i=typeof(r==null?void 0:r.lng)=="function"?r.lng():r==null?void 0:r.lng;w==null||w({address:s.formattedAddress??o,lat:l,lng:i,placeDetails:{name:s.displayName,formattedAddress:s.formattedAddress}});const p=h.current;p!=null&&p.AutocompleteSessionToken&&(N.current=new p.AutocompleteSessionToken)}catch(s){console.warn("Place fetchFields failed",s),w==null||w({address:o,lat:void 0,lng:void 0,placeDetails:{}})}},J=t=>{if(!(!P||d.length===0))switch(t.key){case"ArrowDown":t.preventDefault(),x(e=>e<d.length-1?e+1:e);break;case"ArrowUp":t.preventDefault(),x(e=>e>0?e-1:e);break;case"Enter":t.preventDefault(),f>=0&&d[f]&&D(d[f]);break;case"Escape":u(!1),x(-1);break}};n.useEffect(()=>{const t=e=>{j.current&&!j.current.contains(e.target)&&k.current&&!k.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const Q={ref:j,id:F,value:K,onChange:Y,onKeyDown:J,onFocus:()=>{d.length>0&&u(!0)},placeholder:M,disabled:z,className:`form-control ${b?"is-invalid":""} ${_}`,autoComplete:"off"},X=E==="textarea"?"textarea":"input";return a.jsxs("div",{className:"position-relative",children:[a.jsxs("div",{className:"input-group",children:[a.jsx(X,{...Q,...E==="textarea"?{rows:O}:{type:"text"}}),a.jsx("div",{className:"input-group-append",children:a.jsx("span",{className:"input-group-text",children:V?a.jsx("span",{className:"spinner-border spinner-border-sm",role:"status",children:a.jsx("span",{className:"sr-only",children:"Loading..."})}):a.jsx("i",{className:"fas fa-map-marker-alt"})})})]}),P&&d.length>0&&a.jsxs("div",{ref:k,className:"position-absolute w-100 mt-1 shadow-lg rounded bg-white border",style:{zIndex:1060,maxHeight:"300px",overflowY:"auto"},children:[d.map((t,e)=>{var o;return a.jsx("div",{className:`px-3 py-2 cursor-pointer ${e===f?"bg-primary text-white":"hover:bg-light"}`,style:{cursor:"pointer",backgroundColor:e===f?"#007bff":void 0,color:e===f?"#fff":void 0},onClick:()=>D(t),onMouseEnter:()=>x(e),children:a.jsxs("div",{className:"d-flex align-items-start",children:[a.jsx("i",{className:"fas fa-map-marker-alt mr-2 mt-1",style:{color:e===f?"#fff":"#6c757d",fontSize:"0.875rem"}}),a.jsxs("div",{className:"flex-grow-1",style:{minWidth:0},children:[a.jsx("div",{className:"font-weight-medium",style:{fontSize:"0.9rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:W(t)}),a.jsx("div",{style:{fontSize:"0.8rem",opacity:.8,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:B(t)})]})]})},((o=t.placePrediction)==null?void 0:o.placeId)??e)}),a.jsx("div",{className:"px-3 py-1 text-muted text-center border-top",style:{fontSize:"0.7rem"},children:a.jsx("img",{src:"https://maps.gstatic.com/mapfiles/api-3/images/powered-by-google-on-white3.png",alt:"Powered by Google",style:{height:"14px"}})})]}),!R()&&a.jsxs("small",{className:"form-text text-muted",children:[a.jsx("i",{className:"fas fa-info-circle mr-1"}),"Address autocomplete is disabled. Configure Google Maps API key to enable."]}),b&&a.jsx("span",{className:"invalid-feedback d-block",children:b})]})}export{ee as A};
