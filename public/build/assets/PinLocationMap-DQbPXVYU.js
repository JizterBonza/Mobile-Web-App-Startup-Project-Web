import{r as u,j as s}from"./app-BOLgj3qB.js";const R={lat:14.5995,lng:120.9842},$=14;function z({initialLat:g,initialLng:f,initialAddress:O="",initialCity:F="",initialPostalCode:T="",onLocationSelect:a,apiKey:j,height:x=320,className:v="",error:k}){const h=u.useRef(null),M=u.useRef(null),m=u.useRef(null),[y,_]=u.useState(!1),[I,P]=u.useState(!1),[E,N]=u.useState(null),G=()=>j||typeof window<"u"&&window.GOOGLE_MAPS_API_KEY||"";u.useEffect(()=>{var e,n;const l=G();if(!l){N("Google Maps API key is not configured.");return}if((n=(e=window.google)==null?void 0:e.maps)!=null&&n.Map){_(!0);return}if(document.querySelector('script[src*="maps.googleapis.com"]')){const d=setInterval(()=>{var c,o;(o=(c=window.google)==null?void 0:c.maps)!=null&&o.Map&&(_(!0),clearInterval(d))},100);return()=>clearInterval(d)}const t=`__agrifyPinMapReady_${Date.now()}`;window[t]=()=>{window[t]=null,_(!0)};const r=document.createElement("script");return r.src=`https://maps.googleapis.com/maps/api/js?key=${l}&callback=${t}`,r.async=!0,r.defer=!0,r.onerror=()=>{window[t]=null,N("Failed to load Google Maps.")},document.head.appendChild(r),()=>{window[t]=null}},[j]),u.useEffect(()=>{var r;if(!y||!h.current||!((r=window.google)!=null&&r.maps))return;const l=g!=null&&f!=null&&!isNaN(g)&&!isNaN(f),p=l?{lat:Number(g),lng:Number(f)}:R,t=new window.google.maps.Map(h.current,{center:p,zoom:$,mapTypeControl:!0,streetViewControl:!1,fullscreenControl:!0,zoomControl:!0});if(M.current=t,l){const e=new window.google.maps.Marker({position:p,map:t,draggable:!0,title:"Pinned location"});m.current=e,e.addListener("dragend",()=>{const n=e.getPosition();n&&a&&b(n.lat(),n.lng())})}return t.addListener("click",e=>{const n=e.latLng.lat(),d=e.latLng.lng();if(m.current)m.current.setPosition(e.latLng);else{const c=new window.google.maps.Marker({position:e.latLng,map:t,draggable:!0,title:"Pinned location"});m.current=c,c.addListener("dragend",()=>{const o=c.getPosition();o&&a&&b(o.lat(),o.lng())})}a&&b(n,d)}),()=>{m.current&&(m.current.setMap(null),m.current=null),M.current=null}},[y,g,f]);function b(l,p){var e,n;if(!((n=(e=window.google)==null?void 0:e.maps)!=null&&n.Geocoder))return;P(!0),N(null);const t=new window.google.maps.Geocoder,r={lat:Number(l),lng:Number(p)};t.geocode({location:r},(d,c)=>{if(P(!1),c!=="OK"||!d||d.length===0){a==null||a({address:"",city:"",postal_code:"",latitude:l,longitude:p});return}const o=d[0];let w="",C="";if(o.address_components)for(const i of o.address_components)i.types.includes("locality")&&(w=i.long_name||i.short_name||""),i.types.includes("postal_code")&&(C=i.long_name||i.short_name||""),!w&&i.types.includes("administrative_area_level_2")&&(w=i.long_name||i.short_name||"");const A=o.formatted_address||"";a==null||a({address:A,city:w,postal_code:C,latitude:l,longitude:p})})}return s.jsxs("div",{className:v,children:[G()?y?s.jsxs(s.Fragment,{children:[s.jsx("div",{ref:h,className:"w-100 rounded border",style:{height:`${x}px`,minHeight:200},role:"application","aria-label":"Map to pin location"}),I&&s.jsxs("small",{className:"form-text text-muted mt-1",children:[s.jsx("i",{className:"fas fa-spinner fa-spin mr-1"})," Getting address..."]}),s.jsx("p",{className:"mt-1 mb-0 small text-muted",children:"Click on the map to pin the location. City, Postal Code, and Address will be filled automatically."})]}):s.jsx("div",{className:"border rounded bg-light d-flex align-items-center justify-content-center",style:{height:`${x}px`},children:s.jsx("span",{className:"spinner-border text-primary",role:"status",children:s.jsx("span",{className:"sr-only",children:"Loading map..."})})}):s.jsx("div",{className:"border rounded bg-light d-flex align-items-center justify-content-center text-muted",style:{height:`${x}px`},children:s.jsxs("span",{children:[s.jsx("i",{className:"fas fa-map-marker-alt mr-2"}),"Configure Google Maps API key to use the map."]})}),(E||k)&&s.jsx("span",{className:"invalid-feedback d-block",children:E||k})]})}export{z as P};
